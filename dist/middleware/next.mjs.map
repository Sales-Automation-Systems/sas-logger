{"version":3,"sources":["../../src/core/context.ts","../../src/core/WideEvent.ts","../../src/adapters/axiom.ts","../../src/core/sampling.ts","../../src/middleware/next.ts"],"sourcesContent":["import { AsyncLocalStorage } from \"async_hooks\";\nimport type { WideEvent, EnrichmentData } from \"./types\";\n\n/**\n * AsyncLocalStorage for request-scoped wide event context.\n * This allows any code in the request chain to enrich the event\n * without passing it explicitly through function parameters.\n */\nexport const eventStorage = new AsyncLocalStorage<WideEvent>();\n\n/**\n * Get the current wide event from context.\n * Returns undefined if called outside a request context.\n */\nexport function getCurrentEvent(): WideEvent | undefined {\n  return eventStorage.getStore();\n}\n\n/**\n * Enrich the current wide event with additional data.\n * This is the primary way handlers add business context.\n *\n * @example\n * ```ts\n * enrichEvent({\n *   user: { id: user.id, email: user.email },\n *   business: { dealId: \"deal_123\", action: \"quote_sent\" }\n * })\n * ```\n */\nexport function enrichEvent(data: EnrichmentData): void {\n  const event = eventStorage.getStore();\n  if (!event) {\n    if (process.env.NODE_ENV === \"development\") {\n      console.warn(\n        \"[@sas/logger] enrichEvent called outside request context. Data will be lost.\",\n      );\n    }\n    return;\n  }\n\n  // Merge user data\n  if (data.user) {\n    event.user = { ...event.user, ...data.user };\n  }\n\n  // Merge business data\n  if (data.business) {\n    event.business = { ...event.business, ...data.business };\n  }\n\n  // Merge performance data\n  if (data.performance) {\n    event.performance = { ...event.performance, ...data.performance };\n  }\n\n  // Merge feature flags\n  if (data.feature_flags) {\n    event.feature_flags = { ...event.feature_flags, ...data.feature_flags };\n  }\n}\n\n/**\n * Set the error on the current wide event.\n * Automatically sets outcome to \"error\".\n */\nexport function setEventError(error: Error, retriable = false): void {\n  const event = eventStorage.getStore();\n  if (!event) return;\n\n  event.outcome = \"error\";\n  event.error = {\n    type: error.name || \"Error\",\n    message: error.message,\n    stack: error.stack,\n    retriable,\n  };\n}\n\n/**\n * Generate a unique event ID.\n */\nexport function generateEventId(): string {\n  return `evt_${crypto.randomUUID().replace(/-/g, \"\").slice(0, 16)}`;\n}\n\n/**\n * Generate a trace ID (can be passed from upstream or generated fresh).\n */\nexport function generateTraceId(): string {\n  return crypto.randomUUID().replace(/-/g, \"\");\n}\n","import type { WideEvent, WideEventConfig, EnrichmentData } from \"./types\";\nimport { generateEventId, generateTraceId } from \"./context\";\n\n/**\n * Builder class for creating wide events.\n * Provides a fluent API for constructing events with all context.\n *\n * @example\n * ```ts\n * const event = new WideEventBuilder(config)\n *   .fromRequest(request)\n *   .withUser({ id: user.id, email: user.email })\n *   .withBusiness({ dealId: \"deal_123\" })\n *   .build()\n * ```\n */\nexport class WideEventBuilder {\n  private event: WideEvent;\n  private config: WideEventConfig;\n  private startTime: number;\n\n  constructor(config: WideEventConfig) {\n    this.config = config;\n    this.startTime = Date.now();\n    this.event = this.createBaseEvent();\n  }\n\n  private createBaseEvent(): WideEvent {\n    return {\n      event_id: generateEventId(),\n      trace_id: generateTraceId(),\n      timestamp: new Date().toISOString(),\n      request: {\n        method: \"UNKNOWN\",\n        path: \"/\",\n        duration_ms: 0,\n        status_code: 200,\n      },\n      service: {\n        name: this.config.serviceName,\n        version:\n          this.config.serviceVersion ||\n          process.env.npm_package_version ||\n          \"0.0.0\",\n        environment:\n          this.config.environment ||\n          process.env.VERCEL_ENV ||\n          process.env.NODE_ENV ||\n          \"development\",\n        region: process.env.VERCEL_REGION || process.env.AWS_REGION,\n        deployment_id: process.env.VERCEL_DEPLOYMENT_ID,\n      },\n      outcome: \"success\",\n    };\n  }\n\n  /**\n   * Set request details from a Request object (Web API).\n   */\n  fromRequest(request: Request, traceId?: string): this {\n    const url = new URL(request.url);\n\n    this.event.request = {\n      ...this.event.request,\n      method: request.method,\n      path: url.pathname,\n      query: Object.fromEntries(url.searchParams),\n      user_agent: request.headers.get(\"user-agent\") || undefined,\n    };\n\n    // Use provided trace ID or check header or generate new\n    this.event.trace_id =\n      traceId ||\n      request.headers.get(\"x-trace-id\") ||\n      request.headers.get(\"x-request-id\") ||\n      generateTraceId();\n\n    return this;\n  }\n\n  /**\n   * Set request details from raw values (for non-standard request objects).\n   */\n  fromRawRequest(details: {\n    method: string;\n    path: string;\n    query?: Record<string, string>;\n    ip?: string;\n    userAgent?: string;\n    traceId?: string;\n  }): this {\n    this.event.request = {\n      ...this.event.request,\n      method: details.method,\n      path: details.path,\n      query: details.query,\n      ip: details.ip,\n      user_agent: details.userAgent,\n    };\n\n    if (details.traceId) {\n      this.event.trace_id = details.traceId;\n    }\n\n    return this;\n  }\n\n  /**\n   * Add user context.\n   */\n  withUser(user: WideEvent[\"user\"]): this {\n    this.event.user = user;\n    return this;\n  }\n\n  /**\n   * Add business context.\n   */\n  withBusiness(business: WideEvent[\"business\"]): this {\n    this.event.business = { ...this.event.business, ...business };\n    return this;\n  }\n\n  /**\n   * Add performance metrics.\n   */\n  withPerformance(performance: WideEvent[\"performance\"]): this {\n    this.event.performance = { ...this.event.performance, ...performance };\n    return this;\n  }\n\n  /**\n   * Add feature flags.\n   */\n  withFeatureFlags(flags: Record<string, boolean>): this {\n    this.event.feature_flags = { ...this.event.feature_flags, ...flags };\n    return this;\n  }\n\n  /**\n   * Set error details.\n   */\n  withError(error: Error, retriable = false): this {\n    this.event.outcome = \"error\";\n    this.event.error = {\n      type: error.name || \"Error\",\n      message: error.message,\n      stack: error.stack,\n      retriable,\n    };\n    return this;\n  }\n\n  /**\n   * Set the response status code.\n   */\n  withStatusCode(statusCode: number): this {\n    this.event.request.status_code = statusCode;\n    if (statusCode >= 500) {\n      this.event.outcome = \"error\";\n    } else if (statusCode >= 400) {\n      this.event.outcome = \"warning\";\n    }\n    return this;\n  }\n\n  /**\n   * Enrich with arbitrary data (merges into existing).\n   */\n  enrich(data: EnrichmentData): this {\n    if (data.user) this.event.user = { ...this.event.user, ...data.user };\n    if (data.business)\n      this.event.business = { ...this.event.business, ...data.business };\n    if (data.performance)\n      this.event.performance = {\n        ...this.event.performance,\n        ...data.performance,\n      };\n    if (data.feature_flags)\n      this.event.feature_flags = {\n        ...this.event.feature_flags,\n        ...data.feature_flags,\n      };\n    return this;\n  }\n\n  /**\n   * Finalize the event with duration and return it.\n   */\n  build(): WideEvent {\n    this.event.request.duration_ms = Date.now() - this.startTime;\n    return this.event;\n  }\n\n  /**\n   * Get the raw event (for enrichment during request handling).\n   */\n  getEvent(): WideEvent {\n    return this.event;\n  }\n}\n","import type { WideEvent, WideEventConfig } from \"../core/types\";\n\n/**\n * Axiom transport adapter.\n * Handles sending wide events to Axiom's ingest API.\n */\nexport class AxiomAdapter {\n  private dataset: string;\n  private token: string;\n  private debug: boolean;\n  private baseUrl = \"https://api.axiom.co\";\n  private pendingEvents: WideEvent[] = [];\n  private flushTimeout: NodeJS.Timeout | null = null;\n\n  constructor(config: WideEventConfig) {\n    this.dataset = config.dataset || process.env.AXIOM_DATASET || \"production\";\n    this.token = config.token || process.env.AXIOM_TOKEN || \"\";\n    this.debug = config.debug || false;\n\n    if (!this.token && process.env.NODE_ENV === \"production\") {\n      console.warn(\n        \"[@sas/logger] AXIOM_TOKEN not set. Events will not be sent to Axiom.\",\n      );\n    }\n  }\n\n  /**\n   * Queue an event for sending. Uses batching for efficiency.\n   */\n  send(event: WideEvent): void {\n    if (this.debug) {\n      console.log(\"[@sas/logger] Event:\", JSON.stringify(event, null, 2));\n    }\n\n    if (!this.token) {\n      // No token - just log locally in development\n      if (process.env.NODE_ENV === \"development\") {\n        console.log(\n          `[@sas/logger] [${event.outcome}] ${event.request.method} ${event.request.path} - ${event.request.duration_ms}ms`,\n        );\n      }\n      return;\n    }\n\n    this.pendingEvents.push(event);\n\n    // Batch sends - flush after a short delay or when batch is full\n    if (this.pendingEvents.length >= 10) {\n      this.flush();\n    } else if (!this.flushTimeout) {\n      this.flushTimeout = setTimeout(() => this.flush(), 100);\n    }\n  }\n\n  /**\n   * Send all pending events to Axiom immediately.\n   * Call this before the request ends in serverless environments.\n   */\n  async flush(): Promise<void> {\n    if (this.flushTimeout) {\n      clearTimeout(this.flushTimeout);\n      this.flushTimeout = null;\n    }\n\n    if (this.pendingEvents.length === 0) {\n      return;\n    }\n\n    if (!this.token) {\n      this.pendingEvents = [];\n      return;\n    }\n\n    const events = this.pendingEvents;\n    this.pendingEvents = [];\n\n    try {\n      const response = await fetch(\n        `${this.baseUrl}/v1/datasets/${this.dataset}/ingest`,\n        {\n          method: \"POST\",\n          headers: {\n            Authorization: `Bearer ${this.token}`,\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(events),\n        },\n      );\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\n          `[@sas/logger] Failed to send to Axiom: ${response.status} ${errorText}`,\n        );\n\n        // Log rate limit info if present\n        const remaining = response.headers.get(\"X-IngestLimit-Remaining\");\n        if (remaining) {\n          console.warn(\n            `[@sas/logger] Axiom ingest limit remaining: ${remaining}`,\n          );\n        }\n      } else if (this.debug) {\n        console.log(`[@sas/logger] Sent ${events.length} events to Axiom`);\n      }\n    } catch (error) {\n      console.error(\"[@sas/logger] Error sending to Axiom:\", error);\n      // Don't re-queue events to avoid infinite loops\n    }\n  }\n}\n\n// Singleton instance for convenience\nlet defaultAdapter: AxiomAdapter | null = null;\n\n/**\n * Get or create the default Axiom adapter.\n */\nexport function getAxiomAdapter(config?: WideEventConfig): AxiomAdapter {\n  if (!defaultAdapter && config) {\n    defaultAdapter = new AxiomAdapter(config);\n  }\n  if (!defaultAdapter) {\n    throw new Error(\n      \"[@sas/logger] AxiomAdapter not initialized. Call initLogger first.\",\n    );\n  }\n  return defaultAdapter;\n}\n\n/**\n * Initialize the default Axiom adapter.\n */\nexport function initAxiomAdapter(config: WideEventConfig): AxiomAdapter {\n  defaultAdapter = new AxiomAdapter(config);\n  return defaultAdapter;\n}\n","import type { WideEvent } from \"./types\";\n\n/**\n * Default tail sampling function.\n * Implements the \"always keep errors, always keep slow\" pattern from loggingsucks.com.\n *\n * Rules:\n * 1. Always keep errors (100%)\n * 2. Always keep slow requests (above threshold)\n * 3. Always keep specific user tiers\n * 4. Random sample the rest\n */\nexport function defaultShouldSample(\n  event: WideEvent,\n  options: {\n    /** Latency threshold in ms (default: 2000) */\n    slowThresholdMs?: number;\n    /** User subscriptions to always keep (default: [\"enterprise\"]) */\n    alwaysKeepSubscriptions?: string[];\n    /** Random sample rate for normal events (default: 0.1 = 10%) */\n    sampleRate?: number;\n  } = {},\n): boolean {\n  const {\n    slowThresholdMs = 2000,\n    alwaysKeepSubscriptions = [\"enterprise\", \"premium\"],\n    sampleRate = 0.1,\n  } = options;\n\n  // Rule 1: Always keep errors\n  if (event.outcome === \"error\") {\n    return true;\n  }\n  if (event.request.status_code >= 500) {\n    return true;\n  }\n  if (event.error) {\n    return true;\n  }\n\n  // Rule 2: Always keep slow requests\n  if (event.request.duration_ms > slowThresholdMs) {\n    return true;\n  }\n\n  // Rule 3: Always keep specific user tiers\n  if (\n    event.user?.subscription &&\n    alwaysKeepSubscriptions.includes(event.user.subscription)\n  ) {\n    return true;\n  }\n\n  // Rule 4: Random sample the rest\n  return Math.random() < sampleRate;\n}\n\n/**\n * No sampling - keep everything.\n * Use this when you want complete observability and cost is not a concern.\n */\nexport function keepAll(): boolean {\n  return true;\n}\n\n/**\n * Only keep errors - minimal sampling.\n * Use this for high-traffic routes where you only care about failures.\n */\nexport function keepOnlyErrors(event: WideEvent): boolean {\n  return (\n    event.outcome === \"error\" ||\n    event.request.status_code >= 400 ||\n    event.error !== undefined\n  );\n}\n","import type { WideEvent, WideEventConfig, EnrichmentData } from \"../core/types\";\nimport { WideEventBuilder } from \"../core/WideEvent\";\nimport { eventStorage, enrichEvent as enrichEventCore } from \"../core/context\";\nimport { AxiomAdapter, initAxiomAdapter } from \"../adapters/axiom\";\nimport { defaultShouldSample } from \"../core/sampling\";\n\n// Re-export enrichEvent for convenience\nexport { enrichEvent } from \"../core/context\";\n\n/**\n * Generic route handler type that works with any Next.js version.\n * Uses the standard web Request type to avoid type conflicts between\n * different Next.js versions in the consuming application.\n */\ntype RouteHandler<\n  TRequest extends Request = Request,\n  TContext = { params?: Promise<Record<string, string>> },\n> = (request: TRequest, context?: TContext) => Promise<Response> | Response;\n\n// Extended request type with wide event\nexport interface WideEventRequest extends Request {\n  wideEvent: WideEvent;\n}\n\nlet adapter: AxiomAdapter | null = null;\nlet globalConfig: WideEventConfig | null = null;\n\n/**\n * Initialize the logger for Next.js.\n * Call this once in your instrumentation.ts or at app startup.\n */\nexport function initLogger(config: WideEventConfig): void {\n  globalConfig = config;\n  adapter = initAxiomAdapter(config);\n}\n\n/**\n * Wrap a Next.js App Router route handler with wide event logging.\n *\n * @example\n * ```ts\n * // In app/api/example/route.ts\n * import { withWideEvents, enrichEvent } from '@sas/logger/next'\n *\n * export const GET = withWideEvents(async (req) => {\n *   enrichEvent({ business: { action: 'fetch_data' } })\n *   return NextResponse.json({ data: 'example' })\n * })\n * ```\n */\nexport function withWideEvents<\n  TRequest extends Request = Request,\n  TContext = { params?: Promise<Record<string, string>> },\n>(handler: RouteHandler<TRequest, TContext>): RouteHandler<TRequest, TContext> {\n  return async (request: TRequest, context?: TContext) => {\n    if (!globalConfig) {\n      console.warn(\n        \"[@sas/logger] Logger not initialized. Call initLogger() first.\",\n      );\n      return handler(request, context);\n    }\n\n    const builder = new WideEventBuilder(globalConfig);\n    builder.fromRequest(request);\n\n    const event = builder.getEvent();\n\n    // Run the handler within the event context\n    return eventStorage.run(event, async () => {\n      try {\n        const response = await handler(request, context);\n\n        // Capture status code from response\n        builder.withStatusCode(response.status);\n\n        return response;\n      } catch (error) {\n        // Capture error details\n        if (error instanceof Error) {\n          builder.withError(error);\n        } else {\n          builder.withError(new Error(String(error)));\n        }\n\n        // Re-throw to let Next.js handle it\n        throw error;\n      } finally {\n        // Finalize and send the event\n        const finalEvent = builder.build();\n\n        // Apply sampling\n        const shouldKeep = globalConfig?.shouldSample\n          ? globalConfig.shouldSample(finalEvent)\n          : defaultShouldSample(finalEvent);\n\n        if (shouldKeep && adapter) {\n          adapter.send(finalEvent);\n          await adapter.flush(); // Critical for serverless!\n        }\n      }\n    });\n  };\n}\n\n/**\n * Higher-order function to combine withWideEvents with other wrappers.\n *\n * @example\n * ```ts\n * const handler = compose(\n *   withWideEvents,\n *   withAuth,\n * )(async (req) => {\n *   return NextResponse.json({ ok: true })\n * })\n * ```\n */\nexport function compose<TRequest extends Request = Request>(\n  ...wrappers: Array<\n    (handler: RouteHandler<TRequest>) => RouteHandler<TRequest>\n  >\n): (handler: RouteHandler<TRequest>) => RouteHandler<TRequest> {\n  return (handler) => wrappers.reduceRight((h, wrapper) => wrapper(h), handler);\n}\n\n/**\n * Create a route handler with wide events and custom enrichment.\n * Convenience function for common patterns.\n *\n * @example\n * ```ts\n * export const GET = createHandler({\n *   business: { feature: 'user_profile' }\n * }, async (req) => {\n *   return NextResponse.json({ user: { id: '123' } })\n * })\n * ```\n */\nexport function createHandler<TRequest extends Request = Request>(\n  enrichment: EnrichmentData,\n  handler: RouteHandler<TRequest>,\n): RouteHandler<TRequest> {\n  return withWideEvents(async (request, context) => {\n    enrichEventCore(enrichment);\n    return handler(request, context);\n  });\n}\n\n/**\n * Flush any pending events.\n * Call this before the request ends if not using withWideEvents.\n */\nexport async function flush(): Promise<void> {\n  if (adapter) {\n    await adapter.flush();\n  }\n}\n"],"mappings":"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","names":[]}